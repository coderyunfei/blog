<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node 学习笔记 --- CommonJS 规范 | Jack 的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="vue 教程">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f40e0164.css" as="style"><link rel="preload" href="/blog/assets/js/app.f600d07b.js" as="script"><link rel="preload" href="/blog/assets/js/2.2efda491.js" as="script"><link rel="preload" href="/blog/assets/js/31.24f1d3e3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5759b5a6.js"><link rel="prefetch" href="/blog/assets/js/100.c11c94a0.js"><link rel="prefetch" href="/blog/assets/js/101.7e06bfc4.js"><link rel="prefetch" href="/blog/assets/js/102.cb80e24c.js"><link rel="prefetch" href="/blog/assets/js/103.9e50ef4d.js"><link rel="prefetch" href="/blog/assets/js/104.f367892d.js"><link rel="prefetch" href="/blog/assets/js/105.2533e8b9.js"><link rel="prefetch" href="/blog/assets/js/106.c75fd75e.js"><link rel="prefetch" href="/blog/assets/js/107.e85e7607.js"><link rel="prefetch" href="/blog/assets/js/108.37bf02c9.js"><link rel="prefetch" href="/blog/assets/js/109.e73f9d25.js"><link rel="prefetch" href="/blog/assets/js/11.db96e8cb.js"><link rel="prefetch" href="/blog/assets/js/110.bae650db.js"><link rel="prefetch" href="/blog/assets/js/111.b7182f59.js"><link rel="prefetch" href="/blog/assets/js/112.5ffa81c6.js"><link rel="prefetch" href="/blog/assets/js/113.d3bcacac.js"><link rel="prefetch" href="/blog/assets/js/114.ab5de741.js"><link rel="prefetch" href="/blog/assets/js/115.1504cff6.js"><link rel="prefetch" href="/blog/assets/js/116.65ce00ed.js"><link rel="prefetch" href="/blog/assets/js/117.775044e3.js"><link rel="prefetch" href="/blog/assets/js/118.4b6fa708.js"><link rel="prefetch" href="/blog/assets/js/119.6cf264d3.js"><link rel="prefetch" href="/blog/assets/js/12.7cf66971.js"><link rel="prefetch" href="/blog/assets/js/120.232630d7.js"><link rel="prefetch" href="/blog/assets/js/121.c945ae58.js"><link rel="prefetch" href="/blog/assets/js/122.47855d40.js"><link rel="prefetch" href="/blog/assets/js/123.237e1c10.js"><link rel="prefetch" href="/blog/assets/js/124.b7b86e27.js"><link rel="prefetch" href="/blog/assets/js/125.b26e3cf6.js"><link rel="prefetch" href="/blog/assets/js/126.63ac6d42.js"><link rel="prefetch" href="/blog/assets/js/127.e04913de.js"><link rel="prefetch" href="/blog/assets/js/128.0915a9dd.js"><link rel="prefetch" href="/blog/assets/js/129.f022d29b.js"><link rel="prefetch" href="/blog/assets/js/13.28979dcf.js"><link rel="prefetch" href="/blog/assets/js/130.740fc885.js"><link rel="prefetch" href="/blog/assets/js/131.8f3276f3.js"><link rel="prefetch" href="/blog/assets/js/132.891ae0b7.js"><link rel="prefetch" href="/blog/assets/js/133.34268944.js"><link rel="prefetch" href="/blog/assets/js/134.ef560a04.js"><link rel="prefetch" href="/blog/assets/js/135.4951f5e9.js"><link rel="prefetch" href="/blog/assets/js/136.24ef2c84.js"><link rel="prefetch" href="/blog/assets/js/137.e10dbb5c.js"><link rel="prefetch" href="/blog/assets/js/138.1da174d1.js"><link rel="prefetch" href="/blog/assets/js/139.1111468f.js"><link rel="prefetch" href="/blog/assets/js/14.73229591.js"><link rel="prefetch" href="/blog/assets/js/140.be162f64.js"><link rel="prefetch" href="/blog/assets/js/141.2fce3f92.js"><link rel="prefetch" href="/blog/assets/js/142.a41604d1.js"><link rel="prefetch" href="/blog/assets/js/143.f9d1aa4c.js"><link rel="prefetch" href="/blog/assets/js/144.ab226e1c.js"><link rel="prefetch" href="/blog/assets/js/145.6324972b.js"><link rel="prefetch" href="/blog/assets/js/146.86b94236.js"><link rel="prefetch" href="/blog/assets/js/147.3ed1819e.js"><link rel="prefetch" href="/blog/assets/js/148.e821ae82.js"><link rel="prefetch" href="/blog/assets/js/149.9a720c7e.js"><link rel="prefetch" href="/blog/assets/js/15.4f1e002e.js"><link rel="prefetch" href="/blog/assets/js/150.227aac9d.js"><link rel="prefetch" href="/blog/assets/js/151.37aa781a.js"><link rel="prefetch" href="/blog/assets/js/152.0a82015a.js"><link rel="prefetch" href="/blog/assets/js/153.238470cb.js"><link rel="prefetch" href="/blog/assets/js/154.78fe63ef.js"><link rel="prefetch" href="/blog/assets/js/155.7f5fba4a.js"><link rel="prefetch" href="/blog/assets/js/156.cd63d656.js"><link rel="prefetch" href="/blog/assets/js/157.576bc526.js"><link rel="prefetch" href="/blog/assets/js/158.e2e30983.js"><link rel="prefetch" href="/blog/assets/js/159.8fe06f36.js"><link rel="prefetch" href="/blog/assets/js/16.52685b60.js"><link rel="prefetch" href="/blog/assets/js/160.956e0c74.js"><link rel="prefetch" href="/blog/assets/js/161.22693bfe.js"><link rel="prefetch" href="/blog/assets/js/162.722bbc15.js"><link rel="prefetch" href="/blog/assets/js/163.f00c05f0.js"><link rel="prefetch" href="/blog/assets/js/164.80cf33ec.js"><link rel="prefetch" href="/blog/assets/js/17.86d1ee1c.js"><link rel="prefetch" href="/blog/assets/js/18.3005d22e.js"><link rel="prefetch" href="/blog/assets/js/19.217ec3f9.js"><link rel="prefetch" href="/blog/assets/js/20.f819104b.js"><link rel="prefetch" href="/blog/assets/js/21.9c4ffbca.js"><link rel="prefetch" href="/blog/assets/js/22.0aea007b.js"><link rel="prefetch" href="/blog/assets/js/23.2eb06be8.js"><link rel="prefetch" href="/blog/assets/js/24.23dae9ca.js"><link rel="prefetch" href="/blog/assets/js/25.b70e20cb.js"><link rel="prefetch" href="/blog/assets/js/26.9a61c322.js"><link rel="prefetch" href="/blog/assets/js/27.ac5ed80b.js"><link rel="prefetch" href="/blog/assets/js/28.9114ae6c.js"><link rel="prefetch" href="/blog/assets/js/29.f8eab0e6.js"><link rel="prefetch" href="/blog/assets/js/3.6fec1244.js"><link rel="prefetch" href="/blog/assets/js/30.79b9fd10.js"><link rel="prefetch" href="/blog/assets/js/32.cb8c8e14.js"><link rel="prefetch" href="/blog/assets/js/33.50564978.js"><link rel="prefetch" href="/blog/assets/js/34.93d14ef6.js"><link rel="prefetch" href="/blog/assets/js/35.9d1649ee.js"><link rel="prefetch" href="/blog/assets/js/36.9bc1f106.js"><link rel="prefetch" href="/blog/assets/js/37.84853c82.js"><link rel="prefetch" href="/blog/assets/js/38.9f600edf.js"><link rel="prefetch" href="/blog/assets/js/39.b47cb433.js"><link rel="prefetch" href="/blog/assets/js/4.ec0140bd.js"><link rel="prefetch" href="/blog/assets/js/40.9ccc0594.js"><link rel="prefetch" href="/blog/assets/js/41.01250879.js"><link rel="prefetch" href="/blog/assets/js/42.d60a39ea.js"><link rel="prefetch" href="/blog/assets/js/43.bb6abe12.js"><link rel="prefetch" href="/blog/assets/js/44.f1827278.js"><link rel="prefetch" href="/blog/assets/js/45.f3339292.js"><link rel="prefetch" href="/blog/assets/js/46.1c304a2b.js"><link rel="prefetch" href="/blog/assets/js/47.431a2b22.js"><link rel="prefetch" href="/blog/assets/js/48.ad234636.js"><link rel="prefetch" href="/blog/assets/js/49.67ad5b83.js"><link rel="prefetch" href="/blog/assets/js/5.3ec83be7.js"><link rel="prefetch" href="/blog/assets/js/50.b0733796.js"><link rel="prefetch" href="/blog/assets/js/51.c86649b3.js"><link rel="prefetch" href="/blog/assets/js/52.e2228f69.js"><link rel="prefetch" href="/blog/assets/js/53.8e49c1f4.js"><link rel="prefetch" href="/blog/assets/js/54.5542fcf9.js"><link rel="prefetch" href="/blog/assets/js/55.bf4d78dd.js"><link rel="prefetch" href="/blog/assets/js/56.ac5dd9d6.js"><link rel="prefetch" href="/blog/assets/js/57.b9a9c4a2.js"><link rel="prefetch" href="/blog/assets/js/58.f8dfabd2.js"><link rel="prefetch" href="/blog/assets/js/59.ef9edf8c.js"><link rel="prefetch" href="/blog/assets/js/6.a48d7718.js"><link rel="prefetch" href="/blog/assets/js/60.6ac72368.js"><link rel="prefetch" href="/blog/assets/js/61.46bc7de5.js"><link rel="prefetch" href="/blog/assets/js/62.b9fa4071.js"><link rel="prefetch" href="/blog/assets/js/63.ef4370f5.js"><link rel="prefetch" href="/blog/assets/js/64.a436c5be.js"><link rel="prefetch" href="/blog/assets/js/65.fb4bf376.js"><link rel="prefetch" href="/blog/assets/js/66.bad0cffd.js"><link rel="prefetch" href="/blog/assets/js/67.29b8bb71.js"><link rel="prefetch" href="/blog/assets/js/68.b7ae577e.js"><link rel="prefetch" href="/blog/assets/js/69.5a855c9d.js"><link rel="prefetch" href="/blog/assets/js/7.e84e9cdf.js"><link rel="prefetch" href="/blog/assets/js/70.df9ab8df.js"><link rel="prefetch" href="/blog/assets/js/71.9328d7e2.js"><link rel="prefetch" href="/blog/assets/js/72.3580533a.js"><link rel="prefetch" href="/blog/assets/js/73.16ba35eb.js"><link rel="prefetch" href="/blog/assets/js/74.2d0d9b5b.js"><link rel="prefetch" href="/blog/assets/js/75.09e10dbd.js"><link rel="prefetch" href="/blog/assets/js/76.56e0338c.js"><link rel="prefetch" href="/blog/assets/js/77.a99acafc.js"><link rel="prefetch" href="/blog/assets/js/78.17d1d404.js"><link rel="prefetch" href="/blog/assets/js/79.50ed2296.js"><link rel="prefetch" href="/blog/assets/js/8.d6346ba1.js"><link rel="prefetch" href="/blog/assets/js/80.6d76cbea.js"><link rel="prefetch" href="/blog/assets/js/81.7a8a8125.js"><link rel="prefetch" href="/blog/assets/js/82.ab110344.js"><link rel="prefetch" href="/blog/assets/js/83.534159b7.js"><link rel="prefetch" href="/blog/assets/js/84.1cacb036.js"><link rel="prefetch" href="/blog/assets/js/85.6ea1a18c.js"><link rel="prefetch" href="/blog/assets/js/86.45d2d704.js"><link rel="prefetch" href="/blog/assets/js/87.397bf3ec.js"><link rel="prefetch" href="/blog/assets/js/88.a3ac0d51.js"><link rel="prefetch" href="/blog/assets/js/89.181ef1b6.js"><link rel="prefetch" href="/blog/assets/js/9.10eb84ee.js"><link rel="prefetch" href="/blog/assets/js/90.cf532ce7.js"><link rel="prefetch" href="/blog/assets/js/91.6a34527e.js"><link rel="prefetch" href="/blog/assets/js/92.64450dbe.js"><link rel="prefetch" href="/blog/assets/js/93.d99dd7ba.js"><link rel="prefetch" href="/blog/assets/js/94.6300a04e.js"><link rel="prefetch" href="/blog/assets/js/95.74437fc5.js"><link rel="prefetch" href="/blog/assets/js/96.726f109c.js"><link rel="prefetch" href="/blog/assets/js/97.d9b26abd.js"><link rel="prefetch" href="/blog/assets/js/98.7c6a019e.js"><link rel="prefetch" href="/blog/assets/js/99.1e91aa55.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f40e0164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Jack 的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/blog/vue3/" class="nav-link">
  vue3
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link router-link-active">
  node
</a></div><div class="nav-item"><a href="/blog/science/" class="nav-link">
  科学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/functional-programming/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/blog/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/dev-tool/" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/mac/" class="nav-link">
  mac使用
</a></li></ul></div></div> <a href="https://github.com/jackchoumine/vue-press-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/blog/vue3/" class="nav-link">
  vue3
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link router-link-active">
  node
</a></div><div class="nav-item"><a href="/blog/science/" class="nav-link">
  科学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/functional-programming/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/blog/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/dev-tool/" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/mac/" class="nav-link">
  mac使用
</a></li></ul></div></div> <a href="https://github.com/jackchoumine/vue-press-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>node 学习笔记 --- CommonJS 规范</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#module-对象" class="sidebar-link">module 对象</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#exports-变量" class="sidebar-link">exports 变量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#require-命令" class="sidebar-link">require 命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#加载规则" class="sidebar-link">加载规则</a></li><li class="sidebar-sub-header"><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#目录的加载规则" class="sidebar-link">目录的加载规则</a></li><li class="sidebar-sub-header"><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#node-模块分类" class="sidebar-link">node 模块分类</a></li><li class="sidebar-sub-header"><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#模块的缓存" class="sidebar-link">模块的缓存</a></li><li class="sidebar-sub-header"><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#require-main" class="sidebar-link">require.main</a></li></ul></li><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#模块加载机制" class="sidebar-link">模块加载机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/node/node%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8BCommonJS%E8%A7%84%E8%8C%83.html#参考文章" class="sidebar-link">参考文章</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-学习笔记-commonjs-规范"><a href="#node-学习笔记-commonjs-规范" class="header-anchor">#</a> node 学习笔记 --- CommonJS 规范</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>为了开发大型复杂应用、代码便于管理，制定了不同的 JS 代码模块化规范。</p> <ul><li>CommonJS：node 的模块化实现了 CommonJS 规范，<code>同步加载</code>。</li> <li>AMD ：异步模块定义规范，<code>异步加载</code>，是 RequireJS 在推广过程中对模块定义的规范产出，推崇依赖前置；</li> <li>ES6：ES6 模块化的设计思想是尽量静态化，编译时就能确定模块依赖关系；</li> <li>CMD : 是 SeaJS 在推广时对模块定义的规范化产出，推崇依赖就近；</li> <li>UMD : 兼容 AMD 和 CommonJS 的规范化的同时，还兼容全局引用的方式。</li></ul> <p>CommonJS 规范希望 JS 代码能在任何地方运行，具备开发大型应用的能力，node 的模块化采用 CommonJS 规范实现。</p> <p><strong>一个文件就是一个模块</strong>，有自己的作用域。文件中的变量、函数、类都是私有的，其他文件不可见。</p> <p>每个模块内部，<code>module</code>变量代表当前模块。这是一个对象，<code>exports</code> 属性是导入模块的接口，<code>require</code>一个模块，就是加载<code>exports</code>属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// example.js</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">let</span> <span class="token function-variable function">addX</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value <span class="token operator">+</span> x
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>x <span class="token operator">=</span> x
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>addX <span class="token operator">=</span> addX
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//test.js</span>
<span class="token keyword">let</span> example <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./example'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span> <span class="token comment">//{}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment">//5</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">addX</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">//8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>CommonJS 模块特点：</p> <blockquote><ol><li>所有代码都运行在模块的作用域内，不会污染全局作用域；</li> <li>模块可多次加载，但是只会在第一次加载时运行一次，以后加载从<strong>缓存</strong>中读取。不想要运行该模块，必须清除缓存；</li> <li>按照代码出现的顺序加载。</li></ol></blockquote> <h2 id="module-对象"><a href="#module-对象" class="header-anchor">#</a> module 对象</h2> <p>node 内部提供了 Module 构建函数。所有模块都是 Module 的实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
  <span class="token keyword">this</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>module</code> 的属性：</p> <blockquote><p>id : 模块识别符，带有<strong>绝对路径</strong>的模块文件名；
filename: 模块文件名，带有绝对路径；
loaded : 布尔值，模块是否加载完成；
parent ： module 对象，引用本模块的模块；
children : module 数组， 本模块引用的其他模块；
exports ：对象，本模块的导出值是其属性。</p></blockquote> <p>没被其他模块引用的模块通常是程序入口，此时 <code>parent</code> 属性是为 <code>null</code>，可根据该特性判断是否为程序入口。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>module<span class="token punctuation">.</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// run with `node something.js`</span>
  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8088</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app listening on port 8088'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// used with `require('/.something.js')`</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="exports-变量"><a href="#exports-变量" class="header-anchor">#</a> exports 变量</h2> <p>为了方便，node 为每个模块提供了 exports 变量，指向 <code>module.exports</code>，即</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可向 <code>exports</code>对象加添加属性和方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">area</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><strong>不能直接将 exports 变量指向一个值，因为这样等于切断了 exports = module.exports 的联系</strong></p></blockquote> <p>一个模块的对外接口，是一个单一的值（<strong>一个函数</strong>或者<strong>一个变量</strong>），<code>不能使用</code> <code>exports</code> 输出，<strong>只能使用<code>module.exports</code>输出</strong>。
<br> <strong>在<code>exports</code>上添加属性，再导出，导出的是一个对象。</strong> <code>exports.prop = value</code> 等同于 <code>module.exports = {prop:value}</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//example.1.js 在exports添加属性</span>
<span class="token keyword">let</span> <span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>print <span class="token operator">=</span> print
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//example.2.js 将单一的值赋值给 module.exports</span>
<span class="token keyword">let</span> <span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> print
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//example.3.js 将单一的值赋值给</span>
<span class="token keyword">let</span> <span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
exports <span class="token operator">=</span> print
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//test.js</span>
<span class="token keyword">let</span> example1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./example.1'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> example2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./example.2'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> example3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./example.3'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example1<span class="token punctuation">)</span> <span class="token comment">// { print: [Function: print] }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example2<span class="token punctuation">)</span> <span class="token comment">// [Function:print]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example3<span class="token punctuation">)</span> <span class="token comment">// {} 给 exports 赋值只能导出空对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>为了简化，只用 <code>module.exports</code>导出值。</p></blockquote> <blockquote><p>全局模块</p></blockquote> <p>可将变量、函数等附加到全局变量<code>global</code>上，无需引入即可使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>global<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'I am node'</span>
<span class="token comment">// 在项目里可全局使用 name</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="require-命令"><a href="#require-命令" class="header-anchor">#</a> require 命令</h2> <p><code>require</code>的基本功能是：<strong>读取</strong>并<strong>执行</strong>一个模块，返回该模块的 <code>exports</code>对象，可用解构赋值的方式提取部分属性，没有发现模块，报错。</p> <h3 id="加载规则"><a href="#加载规则" class="header-anchor">#</a> 加载规则</h3> <ol><li>参数以 <code>/</code>开头，加载绝对路径下的模块；</li> <li>参数以 <code>./</code>开头，加载当前目录下的模块；</li> <li>不以 <code>./</code>或 <code>/</code>开头，加载核心模块或依次在各级 <code>node_modules</code>目录的查找；</li> <li>想得到包含文件名的完整路径，使用 <code>require.resolve()</code>。</li></ol> <h3 id="目录的加载规则"><a href="#目录的加载规则" class="header-anchor">#</a> 目录的加载规则</h3> <p>通常把相关文件放在一个目录下，便于组织。这时最好为目录设置一个<code>入口文件</code>，<code>require</code>方法能根据这个文件，加载整个目录。</p> <p>npm 包都有一个 <code>package.json</code>，写入<code>main</code>字段，这是 npm 包的入口。</p> <p>package.json 文件由 <code>npm init</code>命令生成，<code>npm init -y</code> 可不用一一 回答询问，直接采用默认值，再手动修改。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some-library&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/some-library.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>require</code>发现参数为一个目录，会先查找该目录下的 <code>package.json</code>文件，加载<code>main</code>字段指定的入口文件。没有<code>main</code>字段或者没有<code>package.json</code>文件，则加载该目录下的<code>index.js</code>文件或者<code>index.node</code>。</p> <h3 id="node-模块分类"><a href="#node-模块分类" class="header-anchor">#</a> node 模块分类</h3> <ul><li><p>核心模块，内置在 node 内部的，直接引用即可。</p></li> <li><p>第三方模块</p> <ul><li>用 npm 下载，安装到程序目录的 <code>node_modules</code>文件夹中；</li> <li>模块加载时，会先在核心模块中搜索，再到程序的<code>node_modules</code>文件夹中搜索。</li></ul></li> <li><p>文件模块</p></li> <li><p>文件夹模块
按照目录加载机制加载。</p></li></ul> <h3 id="模块的缓存"><a href="#模块的缓存" class="header-anchor">#</a> 模块的缓存</h3> <p>第一次加载，以后从缓存中读取<code>module.exports</code>属性。
所有模块的缓存都保存在 <code>require.cache</code>中。
删除模块缓存：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 删除指定模块缓存</span>
<span class="token keyword">delete</span> require<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
<span class="token comment">// 删除所有模块缓存</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>cache<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">delete</span> require<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="require-main"><a href="#require-main" class="header-anchor">#</a> require.main</h3> <p><code>main</code>属性，可用来判断是直接执行还是调用执行。
直接执行：<code>node module.js</code>，require.main 属性指向模块本身。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//直接执行 表达式为 true</span>
require<span class="token punctuation">.</span>main <span class="token operator">===</span> module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过<code>require</code>加载模块执行，上面的表达式为<code>false</code></p> <h2 id="模块加载机制"><a href="#模块加载机制" class="header-anchor">#</a> 模块加载机制</h2> <p>模块一旦输出值，模块内部的变化，影响不到这个输出值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">let</span> <span class="token function-variable function">incCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'模块内部'</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lib'</span><span class="token punctuation">,</span> require<span class="token punctuation">.</span>main <span class="token operator">===</span> module<span class="token punctuation">)</span> <span class="token comment">// 被require 执行，输出 false</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token punctuation">,</span>
  incCounter<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// test.1.js</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter
<span class="token keyword">let</span> incCounter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>incCounter
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'模块外部'</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span> <span class="token comment">//3</span>
<span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 模块内部的值改变为 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'模块外部'</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span> <span class="token comment">//外部的值 还是为3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> require<span class="token punctuation">.</span>main <span class="token operator">===</span> module<span class="token punctuation">)</span>
<span class="token comment">// 直接执行，输出 true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>最后输出：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>lib <span class="token boolean">false</span>
模块外部 <span class="token number">3</span>
模块内部 <span class="token number">4</span>
模块外部 <span class="token number">3</span>
<span class="token builtin class-name">test</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <p><a href="https://javascript.ruanyifeng.com/nodejs/module.html" target="_blank" rel="noopener noreferrer">CommonJS 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/entry/5b2afc3551882574e321dcf1" target="_blank" rel="noopener noreferrer">前端模块化（一）nodeJS 中的 CommonJS 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.f600d07b.js" defer></script><script src="/blog/assets/js/2.2efda491.js" defer></script><script src="/blog/assets/js/31.24f1d3e3.js" defer></script>
  </body>
</html>
