<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue 指令总结 | Jack 的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="vue 教程">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f40e0164.css" as="style"><link rel="preload" href="/blog/assets/js/app.f600d07b.js" as="script"><link rel="preload" href="/blog/assets/js/2.2efda491.js" as="script"><link rel="preload" href="/blog/assets/js/132.891ae0b7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5759b5a6.js"><link rel="prefetch" href="/blog/assets/js/100.c11c94a0.js"><link rel="prefetch" href="/blog/assets/js/101.7e06bfc4.js"><link rel="prefetch" href="/blog/assets/js/102.cb80e24c.js"><link rel="prefetch" href="/blog/assets/js/103.9e50ef4d.js"><link rel="prefetch" href="/blog/assets/js/104.f367892d.js"><link rel="prefetch" href="/blog/assets/js/105.2533e8b9.js"><link rel="prefetch" href="/blog/assets/js/106.c75fd75e.js"><link rel="prefetch" href="/blog/assets/js/107.e85e7607.js"><link rel="prefetch" href="/blog/assets/js/108.37bf02c9.js"><link rel="prefetch" href="/blog/assets/js/109.e73f9d25.js"><link rel="prefetch" href="/blog/assets/js/11.db96e8cb.js"><link rel="prefetch" href="/blog/assets/js/110.bae650db.js"><link rel="prefetch" href="/blog/assets/js/111.b7182f59.js"><link rel="prefetch" href="/blog/assets/js/112.5ffa81c6.js"><link rel="prefetch" href="/blog/assets/js/113.d3bcacac.js"><link rel="prefetch" href="/blog/assets/js/114.ab5de741.js"><link rel="prefetch" href="/blog/assets/js/115.1504cff6.js"><link rel="prefetch" href="/blog/assets/js/116.65ce00ed.js"><link rel="prefetch" href="/blog/assets/js/117.775044e3.js"><link rel="prefetch" href="/blog/assets/js/118.4b6fa708.js"><link rel="prefetch" href="/blog/assets/js/119.6cf264d3.js"><link rel="prefetch" href="/blog/assets/js/12.7cf66971.js"><link rel="prefetch" href="/blog/assets/js/120.232630d7.js"><link rel="prefetch" href="/blog/assets/js/121.c945ae58.js"><link rel="prefetch" href="/blog/assets/js/122.47855d40.js"><link rel="prefetch" href="/blog/assets/js/123.237e1c10.js"><link rel="prefetch" href="/blog/assets/js/124.b7b86e27.js"><link rel="prefetch" href="/blog/assets/js/125.b26e3cf6.js"><link rel="prefetch" href="/blog/assets/js/126.63ac6d42.js"><link rel="prefetch" href="/blog/assets/js/127.e04913de.js"><link rel="prefetch" href="/blog/assets/js/128.0915a9dd.js"><link rel="prefetch" href="/blog/assets/js/129.f022d29b.js"><link rel="prefetch" href="/blog/assets/js/13.28979dcf.js"><link rel="prefetch" href="/blog/assets/js/130.740fc885.js"><link rel="prefetch" href="/blog/assets/js/131.8f3276f3.js"><link rel="prefetch" href="/blog/assets/js/133.34268944.js"><link rel="prefetch" href="/blog/assets/js/134.ef560a04.js"><link rel="prefetch" href="/blog/assets/js/135.4951f5e9.js"><link rel="prefetch" href="/blog/assets/js/136.24ef2c84.js"><link rel="prefetch" href="/blog/assets/js/137.e10dbb5c.js"><link rel="prefetch" href="/blog/assets/js/138.1da174d1.js"><link rel="prefetch" href="/blog/assets/js/139.1111468f.js"><link rel="prefetch" href="/blog/assets/js/14.73229591.js"><link rel="prefetch" href="/blog/assets/js/140.be162f64.js"><link rel="prefetch" href="/blog/assets/js/141.2fce3f92.js"><link rel="prefetch" href="/blog/assets/js/142.a41604d1.js"><link rel="prefetch" href="/blog/assets/js/143.f9d1aa4c.js"><link rel="prefetch" href="/blog/assets/js/144.ab226e1c.js"><link rel="prefetch" href="/blog/assets/js/145.6324972b.js"><link rel="prefetch" href="/blog/assets/js/146.86b94236.js"><link rel="prefetch" href="/blog/assets/js/147.3ed1819e.js"><link rel="prefetch" href="/blog/assets/js/148.e821ae82.js"><link rel="prefetch" href="/blog/assets/js/149.9a720c7e.js"><link rel="prefetch" href="/blog/assets/js/15.4f1e002e.js"><link rel="prefetch" href="/blog/assets/js/150.227aac9d.js"><link rel="prefetch" href="/blog/assets/js/151.37aa781a.js"><link rel="prefetch" href="/blog/assets/js/152.0a82015a.js"><link rel="prefetch" href="/blog/assets/js/153.238470cb.js"><link rel="prefetch" href="/blog/assets/js/154.78fe63ef.js"><link rel="prefetch" href="/blog/assets/js/155.7f5fba4a.js"><link rel="prefetch" href="/blog/assets/js/156.cd63d656.js"><link rel="prefetch" href="/blog/assets/js/157.576bc526.js"><link rel="prefetch" href="/blog/assets/js/158.e2e30983.js"><link rel="prefetch" href="/blog/assets/js/159.8fe06f36.js"><link rel="prefetch" href="/blog/assets/js/16.52685b60.js"><link rel="prefetch" href="/blog/assets/js/160.956e0c74.js"><link rel="prefetch" href="/blog/assets/js/161.22693bfe.js"><link rel="prefetch" href="/blog/assets/js/162.722bbc15.js"><link rel="prefetch" href="/blog/assets/js/163.f00c05f0.js"><link rel="prefetch" href="/blog/assets/js/164.80cf33ec.js"><link rel="prefetch" href="/blog/assets/js/17.86d1ee1c.js"><link rel="prefetch" href="/blog/assets/js/18.3005d22e.js"><link rel="prefetch" href="/blog/assets/js/19.217ec3f9.js"><link rel="prefetch" href="/blog/assets/js/20.f819104b.js"><link rel="prefetch" href="/blog/assets/js/21.9c4ffbca.js"><link rel="prefetch" href="/blog/assets/js/22.0aea007b.js"><link rel="prefetch" href="/blog/assets/js/23.2eb06be8.js"><link rel="prefetch" href="/blog/assets/js/24.23dae9ca.js"><link rel="prefetch" href="/blog/assets/js/25.b70e20cb.js"><link rel="prefetch" href="/blog/assets/js/26.9a61c322.js"><link rel="prefetch" href="/blog/assets/js/27.ac5ed80b.js"><link rel="prefetch" href="/blog/assets/js/28.9114ae6c.js"><link rel="prefetch" href="/blog/assets/js/29.f8eab0e6.js"><link rel="prefetch" href="/blog/assets/js/3.6fec1244.js"><link rel="prefetch" href="/blog/assets/js/30.79b9fd10.js"><link rel="prefetch" href="/blog/assets/js/31.24f1d3e3.js"><link rel="prefetch" href="/blog/assets/js/32.cb8c8e14.js"><link rel="prefetch" href="/blog/assets/js/33.50564978.js"><link rel="prefetch" href="/blog/assets/js/34.93d14ef6.js"><link rel="prefetch" href="/blog/assets/js/35.9d1649ee.js"><link rel="prefetch" href="/blog/assets/js/36.9bc1f106.js"><link rel="prefetch" href="/blog/assets/js/37.84853c82.js"><link rel="prefetch" href="/blog/assets/js/38.9f600edf.js"><link rel="prefetch" href="/blog/assets/js/39.b47cb433.js"><link rel="prefetch" href="/blog/assets/js/4.ec0140bd.js"><link rel="prefetch" href="/blog/assets/js/40.9ccc0594.js"><link rel="prefetch" href="/blog/assets/js/41.01250879.js"><link rel="prefetch" href="/blog/assets/js/42.d60a39ea.js"><link rel="prefetch" href="/blog/assets/js/43.bb6abe12.js"><link rel="prefetch" href="/blog/assets/js/44.f1827278.js"><link rel="prefetch" href="/blog/assets/js/45.f3339292.js"><link rel="prefetch" href="/blog/assets/js/46.1c304a2b.js"><link rel="prefetch" href="/blog/assets/js/47.431a2b22.js"><link rel="prefetch" href="/blog/assets/js/48.ad234636.js"><link rel="prefetch" href="/blog/assets/js/49.67ad5b83.js"><link rel="prefetch" href="/blog/assets/js/5.3ec83be7.js"><link rel="prefetch" href="/blog/assets/js/50.b0733796.js"><link rel="prefetch" href="/blog/assets/js/51.c86649b3.js"><link rel="prefetch" href="/blog/assets/js/52.e2228f69.js"><link rel="prefetch" href="/blog/assets/js/53.8e49c1f4.js"><link rel="prefetch" href="/blog/assets/js/54.5542fcf9.js"><link rel="prefetch" href="/blog/assets/js/55.bf4d78dd.js"><link rel="prefetch" href="/blog/assets/js/56.ac5dd9d6.js"><link rel="prefetch" href="/blog/assets/js/57.b9a9c4a2.js"><link rel="prefetch" href="/blog/assets/js/58.f8dfabd2.js"><link rel="prefetch" href="/blog/assets/js/59.ef9edf8c.js"><link rel="prefetch" href="/blog/assets/js/6.a48d7718.js"><link rel="prefetch" href="/blog/assets/js/60.6ac72368.js"><link rel="prefetch" href="/blog/assets/js/61.46bc7de5.js"><link rel="prefetch" href="/blog/assets/js/62.b9fa4071.js"><link rel="prefetch" href="/blog/assets/js/63.ef4370f5.js"><link rel="prefetch" href="/blog/assets/js/64.a436c5be.js"><link rel="prefetch" href="/blog/assets/js/65.fb4bf376.js"><link rel="prefetch" href="/blog/assets/js/66.bad0cffd.js"><link rel="prefetch" href="/blog/assets/js/67.29b8bb71.js"><link rel="prefetch" href="/blog/assets/js/68.b7ae577e.js"><link rel="prefetch" href="/blog/assets/js/69.5a855c9d.js"><link rel="prefetch" href="/blog/assets/js/7.e84e9cdf.js"><link rel="prefetch" href="/blog/assets/js/70.df9ab8df.js"><link rel="prefetch" href="/blog/assets/js/71.9328d7e2.js"><link rel="prefetch" href="/blog/assets/js/72.3580533a.js"><link rel="prefetch" href="/blog/assets/js/73.16ba35eb.js"><link rel="prefetch" href="/blog/assets/js/74.2d0d9b5b.js"><link rel="prefetch" href="/blog/assets/js/75.09e10dbd.js"><link rel="prefetch" href="/blog/assets/js/76.56e0338c.js"><link rel="prefetch" href="/blog/assets/js/77.a99acafc.js"><link rel="prefetch" href="/blog/assets/js/78.17d1d404.js"><link rel="prefetch" href="/blog/assets/js/79.50ed2296.js"><link rel="prefetch" href="/blog/assets/js/8.d6346ba1.js"><link rel="prefetch" href="/blog/assets/js/80.6d76cbea.js"><link rel="prefetch" href="/blog/assets/js/81.7a8a8125.js"><link rel="prefetch" href="/blog/assets/js/82.ab110344.js"><link rel="prefetch" href="/blog/assets/js/83.534159b7.js"><link rel="prefetch" href="/blog/assets/js/84.1cacb036.js"><link rel="prefetch" href="/blog/assets/js/85.6ea1a18c.js"><link rel="prefetch" href="/blog/assets/js/86.45d2d704.js"><link rel="prefetch" href="/blog/assets/js/87.397bf3ec.js"><link rel="prefetch" href="/blog/assets/js/88.a3ac0d51.js"><link rel="prefetch" href="/blog/assets/js/89.181ef1b6.js"><link rel="prefetch" href="/blog/assets/js/9.10eb84ee.js"><link rel="prefetch" href="/blog/assets/js/90.cf532ce7.js"><link rel="prefetch" href="/blog/assets/js/91.6a34527e.js"><link rel="prefetch" href="/blog/assets/js/92.64450dbe.js"><link rel="prefetch" href="/blog/assets/js/93.d99dd7ba.js"><link rel="prefetch" href="/blog/assets/js/94.6300a04e.js"><link rel="prefetch" href="/blog/assets/js/95.74437fc5.js"><link rel="prefetch" href="/blog/assets/js/96.726f109c.js"><link rel="prefetch" href="/blog/assets/js/97.d9b26abd.js"><link rel="prefetch" href="/blog/assets/js/98.7c6a019e.js"><link rel="prefetch" href="/blog/assets/js/99.1e91aa55.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f40e0164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Jack 的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/blog/vue3/" class="nav-link router-link-active">
  vue3
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/blog/science/" class="nav-link">
  科学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/functional-programming/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/blog/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/dev-tool/" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/mac/" class="nav-link">
  mac使用
</a></li></ul></div></div> <a href="https://github.com/jackchoumine/vue-press-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/blog/vue3/" class="nav-link router-link-active">
  vue3
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/blog/science/" class="nav-link">
  科学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/others/functional-programming/" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/blog/angular/" class="nav-link">
  angular
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/dev-tool/" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/others/mac/" class="nav-link">
  mac使用
</a></li></ul></div></div> <a href="https://github.com/jackchoumine/vue-press-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue 指令总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#使用方式" class="sidebar-link">使用方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#vue2-指令定义方式" class="sidebar-link">vue2 指令定义方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#钩子的参数" class="sidebar-link">钩子的参数</a></li><li class="sidebar-sub-header"><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#指令钩子和组件生命周期的执行顺序是怎样的" class="sidebar-link">指令钩子和组件生命周期的执行顺序是怎样的？</a></li></ul></li><li><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#vue3-中的指令" class="sidebar-link">vue3 中的指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#定义方式" class="sidebar-link">定义方式</a></li><li class="sidebar-sub-header"><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#hook-vs-指令" class="sidebar-link">hook vs 指令</a></li><li class="sidebar-sub-header"><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#指令钩子函数和组件生命周期的执行顺序" class="sidebar-link">指令钩子函数和组件生命周期的执行顺序</a></li></ul></li><li><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#其他问题" class="sidebar-link">其他问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/vue3/%E6%8C%87%E4%BB%A4.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-指令总结"><a href="#vue-指令总结" class="header-anchor">#</a> vue 指令总结</h1> <p>vue 内置了一些指令，也提供了自定义指令的接口。</p> <p>指令的作用：可把一些可复用的逻辑封装成指令，以实现<strong>逻辑复用</strong>。</p> <p>指令按照使用范围看，分为全局指令和局部指令（在某个组件内部使用的）。</p> <p>指令和组件一样，具有一些在特定时期执行的函数，就是通过它们定义指令的。</p> <h2 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h2> <p>有一个<code>v-test</code>指令。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-test:</span>disabled.foo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>directive'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>:</code>之后的是指令参数，类似<code>v-on:keyup</code>中的 <code>keyup</code>。
<code>.</code>之后的时指令修饰符，foo 是修饰符。</p> <blockquote><p>参数只能有一个，修饰符可有多个。</p></blockquote> <p><code>v-test:disabled:boo.foo.zoo=&quot;msg&quot;</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token string">&quot;disabled:boo&quot;</span>
  <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">zoo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>希望不同情况下绑定不同的参数，可使用<strong>动态参数</strong>。</p> <p><code>v-test:[argu].foo.zoo=&quot;msg&quot;</code></p> <blockquote><p>参数必须在修饰符之前。</p></blockquote> <p>指令的等号后面是指令表达式，其值对应<code>binding</code>对象的 value 属性。</p> <blockquote><p><code>binding</code> 一个对象：</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="vue2-指令定义方式"><a href="#vue2-指令定义方式" class="header-anchor">#</a> vue2 指令定义方式</h2> <p>以插件的形式定义一个全局<code>v-click-outside</code>:</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clickOutside</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'clickOutside'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">inserted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> binding
      <span class="token comment">// const _this = vnode.context</span>
      <span class="token comment">// NOTE 技巧：处理函数挂载在元素上，方便解绑时移出事件监听</span>
      el<span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 点击内部</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clickInside'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 点击外部</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clickOutside'</span><span class="token punctuation">)</span>
          value <span class="token operator">&amp;&amp;</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>onClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>onClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>注册插件：</p> <p>main.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>clickOutside<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用：</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试 v-click-outside<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-click-outside</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onClickOutside<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>测试点击外部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>测试点击外部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>测试点击外部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>测试点击外部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'WebComponent'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      Button<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Hello web components in stencil!'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">onClickOutside</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onClickOutside'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>点击到<code>div</code>外部时，就会执行<code>onClickOutside</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'directive-name'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>options 是一个对象，包含一些生命周期钩子，这些生命周期都是可选的。</p> <p>按照执行顺序可：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">bind</span> <span class="token comment"># 只调用一次，指令绑定到元素时调用，父元素可能不存在。做初始化工作</span>
⬇️
inserted <span class="token comment"># 只调用一次，被绑定的元素插入到父节点，父节点存在，此时可能被绑定元素还每插入文档中。</span>
⬇️
update <span class="token comment"># 此时组件还没更新完毕，拿不到最新的数据</span>
⬇️
componentUpdated <span class="token comment"># 此时组件已经更新完毕 能拿到最新</span>
⬇️
unbind <span class="token comment"># 只调用一次，指令和元素解绑，可做一些收尾工作</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>简写方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'color-swatch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> binding<span class="token punctuation">.</span>value
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>在 bind 和 update 时触发相同行为，而不关心其它的钩子。</p></blockquote> <h3 id="钩子的参数"><a href="#钩子的参数" class="header-anchor">#</a> 钩子的参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">bind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
<span class="token function">inserted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
<span class="token function">update</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span> <span class="token comment">//  update componentUpdated 还有额外的 oldVnode</span>
<span class="token function">componentUpdated</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span>
<span class="token function">unbind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>指令钩子函数的参数，主要关注 <code>el</code> 和 <code>binding</code>。</p></blockquote> <p><code>el</code> 是绑定指令的元素，可对其进行 DOM 操作。</p> <p><code>binding</code> 一个对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>update</code> 和 <code>componentUpdated</code> 钩子函数，binding 对象还有 <code>oldArg</code> 和 <code>oldValue</code> 属性。</p> <h3 id="指令钩子和组件生命周期的执行顺序是怎样的"><a href="#指令钩子和组件生命周期的执行顺序是怎样的" class="header-anchor">#</a> 指令钩子和组件生命周期的执行顺序是怎样的？</h3> <blockquote><p>挂载组件</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>beforeCreate
⬇️
created
⬇️
beforeMount
⬇️
<span class="token builtin class-name">bind</span> <span class="token comment"># 指令 绑定到元素时调用，父元素可能不存在</span>
⬇️
inserted <span class="token comment"># 指令 被绑定元素插入父元素时调用，父元素一定存在</span>
⬇️
mounted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>更新组件</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>beforeUpdate
⬇️
update <span class="token comment"># 指令，此时组件还没更新完毕，拿不到最新的数据</span>
⬇️
componentUpdated <span class="token comment"># 指令 此时组件已经更新完毕 能拿到最新的数据</span>
⬇️
updated
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>销毁组件</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>beforeDestroy
⬇️
unbind <span class="token comment"># 指令 组件在销毁之前调用，仍然能拿到组件的数据</span>
⬇️
destroyed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>重建组件时</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>beforeCreate
⬇️
created <span class="token punctuation">(</span>重建<span class="token punctuation">)</span>
⬇️
beforeMount
⬇️
<span class="token builtin class-name">bind</span> <span class="token comment"># 注意这里，指令绑定这个钩子函数，将会拿不到重建后的最新数据</span>
⬇️
beforeDestroy （组件销毁）
⬇️
unbind <span class="token comment"># 指令</span>
⬇️
destroyed
⬇️
inserted <span class="token comment"># 指令 使用该钩子函数，能拿到重建后的数据</span>
⬇️
mounted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>结论：只有 <code>inserted</code> 和 <code>componentUpdated</code> 生命周期钩子，在执行时组件的 DOM 已经更新完毕，可放心使用。它们可获取到组件更新后的数据，指令绑定的元素的父元素也已经存在。</p></blockquote> <blockquote><p>如何在指令生命周期中使用 <code>this</code> 或者访问组件实例？</p></blockquote> <p>直接使用<code>this</code>为 undefined，可使用<code>vnode.context</code>获取：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">inserted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// setTile 是组件 methods 里的方法</span>
  vnode<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setTile</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">componentUpdated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vnode<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setTile</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="vue3-中的指令"><a href="#vue3-中的指令" class="header-anchor">#</a> vue3 中的指令</h2> <p>vue3 的指令钩子、钩子的参数和定义方式有变化。</p> <h3 id="定义方式"><a href="#定义方式" class="header-anchor">#</a> 定义方式</h3> <p>全局指令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'directive-name'</span><span class="token punctuation">,</span> directiveOptions<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>简写形式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'directive-name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// mounted 和 updated 操作相同</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>局部指令</p> <p>script setup 使用<code>v</code>开头命名。</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 注册一个局部的自定义指令，需要以小写v开头</span>
  <span class="token keyword">const</span> vFocus <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>binding<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vNode<span class="token punctuation">)</span>
      <span class="token comment">// 获取input，并调用其focus()方法</span>
      el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-focus</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>setup 函数方式：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">focus</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取input，并调用其focus()方法</span>
          el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>指令钩子的变化：</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> myDirective <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在绑定元素的 attribute 前</span>
  <span class="token comment">// 或事件监听器应用前调用</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在元素被插入到 DOM 前调用,可执行一些初始化工作</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在绑定元素的父组件</span>
  <span class="token comment">// 及他自己的所有子节点都挂载完成后调用</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件更新前调用</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在绑定元素的父组件</span>
  <span class="token comment">// 及他自己的所有子节点都更新后调用</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件卸载前调用，收尾工作</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绑定元素的父组件卸载后调用</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>常用的钩子：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>beforeMount <span class="token comment"># 类似 vue2 bind</span>
mounted <span class="token comment"># 类似 vue2 inserted</span>
updated <span class="token comment"># 类似 vue2 componentUpdated</span>
beforeUnmount <span class="token comment"># 类似 vue2 unbind</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>binding 的参数有变化：增加了<code>instance</code>属性用于获取组件实例。</p> <p>创建一个检测点击 div 外部的指令：</p> <div class="language-ts line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clickOutside</span> <span class="token operator">=</span> <span class="token punctuation">(</span>app<span class="token operator">:</span> App<span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'clickOutside'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> instance <span class="token punctuation">}</span> <span class="token operator">=</span> binding
      <span class="token comment">// NOTE 技巧：处理函数挂载在元素上，方便解绑时移出事件监听</span>
      el<span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clickInside'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 点击外部</span>
          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clickOutside'</span><span class="token punctuation">)</span>
          <span class="token comment">// console.log(instance)// 组件实例</span>
          value <span class="token operator">&amp;&amp;</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>onClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeUnmount</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'beforeUnmount'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>onClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><blockquote><p>相同的功能使用 hook 实现：</p></blockquote> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> onBeforeUnmount<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useOnClickOutside</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">DOM</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isClickOutside <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DOM</span><span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">DOM</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      isClickOutside<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> isClickOutside
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="hook-vs-指令"><a href="#hook-vs-指令" class="header-anchor">#</a> hook vs 指令</h3> <p>使用方式：hook 在 script 里，指令绑定到模板</p> <p>定义方式：hook 更加简单，只需记住组件的生命钩子，复用更加方便，指令略微繁琐，需要额外记忆指令钩子。</p> <p>hook 能返回响应是对象，指令做不到。</p> <blockquote><p>hook 优势更大，更加灵活</p></blockquote> <h3 id="指令钩子函数和组件生命周期的执行顺序"><a href="#指令钩子函数和组件生命周期的执行顺序" class="header-anchor">#</a> 指令钩子函数和组件生命周期的执行顺序</h3> <p>挂载阶段：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>setup
onBeforeMount
created <span class="token comment"># 指令钩子</span>
beforeMount <span class="token comment"># 指令钩子</span>
mounted <span class="token comment"># 指令钩子</span>
onMounted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>销毁阶段：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>onBeforeUnmount
beforeUnmount <span class="token comment"># 指令钩子</span>
unmounted <span class="token comment"># 指令钩子</span>
onUnmounted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>比较好实践：只定义 mounted、updated 和 beforeUnmount 钩子。</p></blockquote> <h2 id="其他问题"><a href="#其他问题" class="header-anchor">#</a> 其他问题</h2> <p>如何使用代码测试指令呢？</p> <p>我搜索不到相关教程。</p> <p><a href="https://github.com/holylovelqq/vue-unit-test-with-jest/issues/57" target="_blank" rel="noopener noreferrer">github 的一个 issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>有请大佬解答。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>指令是<strong>复用逻辑</strong>的有效方式，尤其是遇到需要直接操作 DOM 的情况。</p> <p>vue2 中常用的指令钩子：inserted、componentUpdated 和 unbind。</p> <p>vue3 中常用的指令钩子：mounted、updated 和 beforeUnmount。</p> <p>vue3 中 <code>script setup</code> 定义局部指令使用 <code>v</code> 开头。</p> <p>vue3 的 binding 对象添加了<code>instance</code>属性。</p> <p>相同的功能 hook 和指令都能实现，hook 优势更大。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.f600d07b.js" defer></script><script src="/blog/assets/js/2.2efda491.js" defer></script><script src="/blog/assets/js/132.891ae0b7.js" defer></script>
  </body>
</html>
